{% extends "home/foundation.html" %}
{% block content %}
    <div class="content-section">
        <img id="id_image_preview" src="{{ user.profile.image.url }}" alt="" width="100" height="100">

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">Edit profile</legend>
                {{ username_and_email_form.as_p }}
                {{ image_form.as_p }}
            </fieldset>
            <div class="form-group">
                <button class="btn btn-outline-info" type="submit">Save</button>
                <a href="/my-profile/">Cancel</a>
            </div>
        </form>

        <script>
            const inputElement = document.getElementById("id_image");
            const imageElement = document.getElementById("id_image_preview");
            let imageBlobURL = undefined;
            //when the user selects a new image, the HTML input element fires a "chnage" event
            //call the update() function when this happens
            inputElement.addEventListener("change", update); 
            
            function update() {
                //revoke the old preview image's blob URL (if any) since it is no longer needed
                URL.revokeObjectURL(imageBlobURL);

                //if the user has selected at least one image file
                if(inputElement.files != undefined && inputElement.files[0] != undefined) {
                    //generate a new blob URL for the first image in the list
                    imageBlobURL = URL.createObjectURL(inputElement.files[0]);
                    //then, using this new blob URL, display the image to the user
                    imageElement.setAttribute("src", imageBlobURL);
                }
            }
        </script>
    </div>
{% endblock content %}
